#
# Travis CI recipe to build glibc binary packages.
#

sudo: required

language: generic

services:
  - docker

env:
  global:
  - GLIBC_VERSION=${TRAVIS_TAG:-2.26}
  matrix:
  - ARCH=x86
  - ARCH=x86_64
  - ARCH=armhf
  - ARCH=aarch64

script:
  - echo "Starting build of glibc $GLIBC_VERSION for $ARCH..."
  - travis_wait 30 ./build-glibc.sh "$ARCH" "$GLIBC_VERSION" --output build.output

after_failure:
  - echo "ERROR: glibc build failed.  Last output:"
  - tail -n 500 build.output

deploy:
  provider: releases
  api_key: $GITHUB_TOKEN
  file_glob: true
  file: build/*.tar.gz
  skip_cleanup: true
  on:
    tags: true
